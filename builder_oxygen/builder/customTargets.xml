<project name="Build specific targets and properties" default="noDefault" xmlns:ivy="antlib:org.apache.ivy.ant">

	<property name="build.root" location=".."/>
	<import file="${build.root}/lib/lib.xml"/>
	
	<property file="${build.root}/config/local.properties"/>
	<property file="${build.root}/config/build.properties"/>
	<property file="${build.root}/common/config/local.properties"/>
	<property file="${build.root}/common/config/build.properties"/>
	
	<!-- ===================================================================== -->
		<!-- Run a given ${target} on all elements being built -->
		<!-- Add on <ant> task for each top level element being built. -->
		<!-- ===================================================================== -->
		<!--<available property="allElementsFile" file="${builder}/allElements.xml" value="${builder}/allElements.xml"/>-->
		<property name="allElementsFile" location="${eclipse.pdebuild.templates}/headless-build/allElements.xml"/>

		<import file="${allElementsFile}" />
		<target name="allElements">
			<antcall target="allElementsDelegator" />
		</target>
		
		<!-- ===================================================================== -->
		<!-- ===================================================================== -->
		<target name="getBaseComponents" depends="checkLocalBase" unless="skipBase">
			<get src="${eclipseBaseURL}" dest="${buildDirectory}/../temp-base.zip" />
			<unzip dest="${base}" overwrite="true" src="${buildDirectory}/../temp-base.zip" />
		</target>

		<target name="checkLocalBase">
			<available file="${base}" property="skipBase" />
		</target>

		<!-- ===================================================================== -->
		<!-- Check out map files from correct repository -->
		<!-- Replace values for mapsCheckoutTag as desired. -->
		<!-- ===================================================================== -->
		<target name="getMapFiles" depends="checkLocalMaps" unless="skipMaps">
			<echo message="Getting map files"/>
			<property name="mapsCheckoutTag" value="HEAD" />
			<mkdir dir="${buildDirectory}/maps"/>
			<copy todir="${buildDirectory}/maps">
				<fileset dir="${builder}/maps">
					<include name="**/*.map"/>
				</fileset>
			</copy>
		</target>

		<target name="checkLocalMaps">
			<available property="skipMaps" file="${buildDirectory}/maps" />
		</target>

		<target name="tagMapFiles" if="tagMaps">
			<cvs dest="${buildDirectory}/maps/${mapsRoot}" command="tag ${mapsTagTag}" />
		</target>

		<!-- ===================================================================== -->

		<target name="clean" unless="noclean">
			<antcall target="allElements">
				<param name="target" value="cleanElement" />
			</antcall>
		</target>

		<target name="gatherLogs">
			<mkdir dir="${buildDirectory}/${buildLabel}/compilelogs" />
			<antcall target="allElements">
				<param name="target" value="gatherLogs" />
			</antcall>
			<unzip dest="${buildDirectory}/${buildLabel}/compilelogs" overwrite="true">
				<fileset dir="${buildDirectory}/features">
					<include name="**/*.log.zip" />
				</fileset>
			</unzip>
		</target>

	
	<target name="preProcessRepos">
		<openscada.import.repository id="org.openscada.external" version="${external.version}"/>
		<openscada.import.repository id="org.openscada.aurora.sdk" version="${aurora.version}"/>
		<openscada.import.repository id="org.openscada.utgard.sdk" version="${utgard.version}"/>
	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: postProcessRepos                      
         - - - - - - - - - - - - - - - - - -->
    <target name="postProcessRepos">
    </target>

	
  <!-- ===================================================================== -->
  <!-- Steps to do before setup -->
  <!-- ===================================================================== -->
  <target name="preSetup">
  	<echo message="Building in: ${buildDirectory}"/>
  	<echo message="SkipMaps: ${skipMaps}"/>
  	<echo message="SkipFetch: ${skipFetch}"/>
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after setup but before starting the build proper -->
  <!-- ===================================================================== -->
  <target name="postSetup">
    <antcall target="getBaseComponents" />

    <!-- OpenSCADA Core -->
  	
  	<openscada.builder.copyFeature id="org.openscada.core"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.core.common" project="openscada_core_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.client.common" project="openscada_core_client_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.server.common" project="openscada_core_server_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.net.base" project="openscada_net_base"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.net.base" project="openscada_core_net_base"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.server.net" project="openscada_core_server_net"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.client.net" project="openscada_core_client_net"/>
  	<openscada.builder.copyPlugin id="org.openscada.core.ice.base" project="openscada_core_ice_base"/>
  		
  	<!-- OpenSCADA DA -->
  	
  	<openscada.builder.copyFeature id="org.openscada.da"/>

  	<openscada.builder.copyPlugin id="org.openscada.da.core" project="openscada_da_core_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.core.server"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.client" project="openscada_da_client_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.client.net" project="openscada_da_client_net"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.net" project="openscada_da_server_net"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.net.base" project="openscada_da_net_base"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.common" project="openscada_da_server_common"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.net" project="openscada_da_server_net"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.da.ice.base" project="openscada_da_ice_base"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.ice" project="openscada_da_server_ice"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.client.ice" project="openscada_da_client_ice"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.da.server.test" project="openscada_da_testserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.sysinfo" project="openscada_da_sysinfoserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.stock" project="openscada_da_stockserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.jdbc" project="openscada_da_jdbcserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.proxy" project="openscada_da_proxyserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.snmp" project="openscada_da_snmpserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.exec" />
  	<openscada.builder.copyPlugin id="org.openscada.da.server.spring" project="openscada_da_springserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.opc" project="openscada_da_opcserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.simulation" project="openscada_da_simserver"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.simulation.component" />
  	
  	<openscada.builder.copyPlugin id="org.openscada.da.server.exporter" project="openscada_server_exporter"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.exporter.spring" project="openscada_server_exporter_spring"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.da.server.osgi"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.osgi.testing"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.server.osgi.exporter.net"/>
  	
  	<!-- OpenSCADA HD -->
  	
  	<openscada.builder.copyFeature id="org.openscada.hd"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.hd"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.client.common"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.client.net"/>
	<openscada.builder.copyPlugin id="org.openscada.hd.net"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.server.common"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.server.common.item"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.server.exporter"/>
	<openscada.builder.copyPlugin id="org.openscada.hd.server.exporter.net"/>
	<openscada.builder.copyPlugin id="org.openscada.hd.server.net"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.server.storage"/>
  	
  	<!-- OpenSCADA AE -->
  	
  	<openscada.builder.copyFeature id="org.openscada.ae"/>
  	  	
  	<openscada.builder.copyPlugin id="org.openscada.ae"/>
  	<openscada.builder.copyPlugin id="org.openscada.ae.net"/>
  	<openscada.builder.copyPlugin id="org.openscada.ae.client.net"/>
	<openscada.builder.copyPlugin id="org.openscada.ae.connection.provider"/>
  	
  	<!-- Additional stuff -->
  	
  	<openscada.builder.copyPlugin id="org.openscada.spring.components" project="openscada_spring_components"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.client.connection.service"/>
  	
  	<openscada.builder.copyPlugin id="org.openscada.core.connection.provider"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.connection.provider"/>
  	<openscada.builder.copyPlugin id="org.openscada.hd.connection.provider"/>
  		
  	<openscada.builder.copyPlugin id="org.openscada.da.master" />
  	<openscada.builder.copyPlugin id="org.openscada.da.datasource"/>
  	<openscada.builder.copyPlugin id="org.openscada.da.datasource.proxy"/>
  	
  	<openscada.builder.copyFeature id="org.openscada.atlantis" />
  	<openscada.builder.copyFeature id="org.openscada.atlantis.sdk" />
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before fetching the build elements -->
  <!-- ===================================================================== -->
  <target name="preFetch">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after fetching the build elements -->
  <!-- ===================================================================== -->
  <target name="postFetch">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before generating the build scripts. -->
  <!-- ===================================================================== -->
  <target name="preGenerate">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after generating the build scripts. -->
  <!-- ===================================================================== -->
  <target name="postGenerate">
    <antcall target="clean" />
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running the build.xmls for the elements being built. -->
  <!-- ===================================================================== -->
  <target name="preProcess">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after running the build.xmls for the elements being built. -->
  <!-- ===================================================================== -->
  <target name="postProcess">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running assemble. -->
  <!-- ===================================================================== -->
  <target name="preAssemble">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after  running assemble. -->
  <!-- ===================================================================== -->
  <target name="postAssemble">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do before running package. -->
  <!-- ===================================================================== -->
  <target name="prePackage">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after  running package. -->
  <!-- ===================================================================== -->
  <target name="postPackage">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do after the build is done. -->
  <!-- ===================================================================== -->
  <target name="postBuild">
    <antcall target="gatherLogs" />
  	<openscada.deploy.repository name="org.openscada.atlantis.sdk"/>
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do to test the build results -->
  <!-- ===================================================================== -->
  <target name="test">
  </target>

  <!-- ===================================================================== -->
  <!-- Steps to do to publish the build results -->
  <!-- ===================================================================== -->
  <target name="publish">
  </target>

  <!-- ===================================================================== -->
  <!-- Default target                                                        -->
  <!-- ===================================================================== -->
  <target name="noDefault">
    <echo message="You must specify a target when invoking this file" />
  </target>

</project>